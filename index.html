<html>
<head>
<title>Game</title>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<script type="text/javascript" src="utils/glMatrix.js"></script>
<script type="text/javascript" src="utils/webgl-utils.js"></script>
<script type="text/javascript" src="utils/webgl.js"></script>
<script type="text/javascript" src="utils/cube.js"></script>
<script type="text/javascript" src="utils/square.js"></script>
<script type="text/javascript" src="gObjects/ground.js"></script>
<script type="text/javascript" src="gObjects/water.js"></script>
<script type="text/javascript" src="gObjects/enemies.js"></script>
<script type="text/javascript" src="gObjects/bullets.js"></script>
<script type="text/javascript" src="gObjects/guns.js"></script>
<script type="text/javascript" src="gObjects/ortho.js"></script>
<script type="text/javascript" src="game.js"></script>




<script id="shader-fs" type="x-shader/x-fragment">  
    precision highp float;
    
    varying vec3 v_normal;   
    varying vec4 v_position;     
    uniform vec4 uVertexColor;    
    uniform float uCounter; 
    uniform float uWaterY;
    
    void main() {
      float light;
      float lightWater;
      float waterIndex=0.0;
      vec4 colorGround;
      vec4 colorWater;

      waterIndex = 0.0 -(v_position.y - uWaterY) ;
      if (waterIndex>1.0) waterIndex = 1.0;
      if (waterIndex<0.0) waterIndex = 0.0;

      float dist = sqrt(v_position.x*v_position.x + v_position.z*v_position.z);
      float x = sin((dist+ 2.0*uCounter)/17.0)/2.0+ 0.50 + sin((dist+ 3.0*uCounter)/35.0)/2.0+ 0.50 + sin((v_position.x + 10.0*uCounter)/60.0)/2.0+0.50;
      float z = cos((dist+ uCounter)/7.0)/2.0+ 0.50 + cos((dist+ 4.0*uCounter)/15.0)/2.0+0.50 + cos((dist+ 6.0*uCounter)/35.0)/2.0+ 0.50 +  cos((v_position.x + 10.0*uCounter)/60.0)/2.0+0.50;
      lightWater = dot(normalize(vec3(x,8.0,z)), vec3(0.0,1.0,0.0));
  
      light = dot(v_normal, vec3(0.0,1.0,0.0)); 
      
      colorGround = vec4(0.1,0.1,0.1,uVertexColor.a); 
      colorWater = vec4(0.1,0.1,0.1,1.0); 
      
      if (light > 0.0)
      {
        colorGround += vec4(uVertexColor.x*light,uVertexColor.y*light,uVertexColor.z*light,0.0) ;
        colorWater += vec4(0.108*lightWater,0.409*lightWater,0.627*lightWater,0.0) ;
      } 

      
      gl_FragColor = mix(colorGround,colorWater,waterIndex);
    }

</script>
<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec4 aVertexPosition;
    attribute vec3 aVertexNormal;
    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    uniform mat4 uMVInverseTransposeMatrix;    
    varying vec3 v_normal;   
    varying vec4 v_position;    
    
    void main() {

      // Multiply the position by the matrix.
      v_position = uMVMatrix * aVertexPosition;
      gl_Position = uPMatrix * uMVMatrix * aVertexPosition;
    
      // orient the normals and pass to the fragment shader
      v_normal =normalize( mat3(uMVInverseTransposeMatrix) * aVertexNormal);

    }
    
</script>
<script type="text/javascript" src="webgl.js"></script>

</head>
<body onload="webGLStart();" onkeydown="mediaSetKeyDownFct(event)" onkeyup="mediaSetKeyUpFct(event)" onmousedown="mediaSetMouseDownFct(event)" onmouseup="mediaSetMouseUpFct(event)" >
<button type="fullscreen" onclick="fullScreen()">fullscreen</button>
<button type="fullscreen" onclick="smallScreen()">small</button>
 <p>
 <canvas id="canvas" style="border: none;" width="1024" height="600"></canvas>

</body>
</html>


